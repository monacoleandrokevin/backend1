<div class="container my-5">
  <h1 class="mb-4 text-primary">🛒 Carrito</h1>

  {{#if carrito.products.length}}
    <ul class="list-group mb-4">
      {{#each carrito.products}}
        <li
          class="list-group-item d-flex justify-content-between align-items-center"
        >
          <div>
            <strong>{{this.product.title}}</strong>
            - ${{this.product.price}}
            x
            {{this.quantity}}
            <div class="text-muted small">{{this.product.description}}</div>
          </div>
          <div>
            <span class="badge bg-secondary me-3">
              Subtotal: ${{this.subtotal}}
            </span>
            <!-- Botón de eliminar por producto -->
            <button
              class="btn btn-sm btn-danger"
              data-pid="{{this.product._id}}"
            >
              🗑
            </button>
          </div>
        </li>
      {{/each}}
    </ul>

    <div class="d-flex justify-content-between align-items-center mb-3">
      <!-- Botón de vaciar carrito -->
      <button class="btn btn-outline-danger" id="vaciarCarritoBtn">
        🧹 Vaciar carrito
      </button>
      <div class="alert alert-success mb-0">
        <strong>Total: ${{carrito.total}}</strong>
      </div>
    </div>
  {{else}}
    <div class="alert alert-warning">El carrito está vacío</div>
  {{/if}}

  <a href="/products" class="btn btn-outline-primary mt-3">⬅ Volver a productos</a>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => { const cartId = "{{carrito._id}}";
  // Botones de eliminar producto const eliminarBtns =
  document.querySelectorAll(".btn-danger"); eliminarBtns.forEach((btn) => {
  btn.addEventListener("click", async () => { const productId = btn.dataset.pid;
  try { const res = await fetch(`/api/carts/${cartId}/products/${productId}`, {
  method: "DELETE", }); if (res.ok) location.reload(); else alert("❌ No se pudo
  eliminar el producto"); } catch (err) { alert("❌ Error eliminando producto");
  } }); }); // Botón de vaciar carrito const vaciarBtn =
  document.getElementById("vaciarCarritoBtn"); if (vaciarBtn) {
  vaciarBtn.addEventListener("click", async () => { if (!confirm("¿Estás seguro
  de vaciar el carrito completo?")) return; try { const res = await
  fetch(`/api/carts/${cartId}`, { method: "DELETE", }); if (res.ok)
  location.reload(); else alert("❌ No se pudo vaciar el carrito"); } catch
  (err) { alert("❌ Error vaciando carrito"); } }); } });
</script>